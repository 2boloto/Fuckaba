Факаба 1.1.0
============

![Скриншот](https://s13.postimg.org/g82j9vxbb/Screenshot.png)

Имиджбордный движок на Брейнфаке.

Обслуживает один тред, позволяет постить картинки, предоставляет средства для модерирования.

Преимущества
------------

- Безопасность. Программа выполняется в очень ограниченной виртуальной машине с 8 командами, код интерпретатора и сетевого драйвера занимает считанные десятки строк, его можно изучить за несколько минут.

- Переносимость. Используется самый распространённый диалект Брейнфака, для которого существует [огромное количество](https://esolangs.org/wiki/Brainfuck_implementations) интерпретаторов и компиляторов под разные платформы. Интерфейс сетевого драйвера может быть очень легко воспроизведён на множестве языков программирования.

- Совместимость с браузерами. Не требует включённого Джаваскрипта (хотя его наличие расширяет возможности движка), был протестирован в нескольких современных браузерах, включая Елинкс.

Особенности
-----------

Полностью синхронный, поддерживает одно соединение в момент времени, поэтому легко поддаётся ДДОСу кнопкой Ф5.

Системные требования
--------------------

Необходим интерпретатор [стандартного](http://www.muppetlabs.com/~breadbox/bf/standards.html) Брейнфака со следующими свойствами:
- 363 МиБ памяти, состоящей из восьмибитных ячеек;
- беззнаковое заворачивание при увеличении 255 или уменьшении 0;
- поведение при выходе за границы памяти, попытке ввести ЕОФ и наличии несбалансированных скобок - неважно.

Для взаимодействия с сетью необходим драйвер, который позволит программе вызывать функции `accept`, `recv`, `send` и `close` с помощью стандартного ввода-вывода.

К движку прилагаются драйвер, интерпретатор и транслятор в Си, написанные на Питоне 3.

Запуск
------

Запуск осуществляется с помощью сетевого драйвера:

	$ ./run.py ./fuckaba.bf localhost 8008

По умолчанию файл `fuckaba.bf` будет выполнен интерпретатором `interpreter.py`, поскольку так указано в его шебанге. Но данный интерпретатор крайне медленен, поэтому лучше скомпилировать движок в нативный код:

	$ ./translator.py fuckaba.bf > fuckaba.c
	$ gcc -std=c99 fuckaba.c -o fuckaba

Использовать оптимизацию `-O3` бессмысленно, при том, что она значительно замедляет компиляцию и требует много памяти. Запуск скомпилированного движка выглядит так:

	$ ./run.py ./fuckaba localhost 8008

Администрирование
-----------------

Администратор может удалять посты, для этого надо добавить к адресу страницы якорь `#admin`. Стандартный пароль `password`, может быть изменён в исходном коде в файле `lib/admin.txt` - он должен быть той же длины в 8 байтов. Это действие потребует пересборки движка:

	$ ./preprocessor.py fuckaba.txt > fuckaba.bf

Пароль можно изменить без пересборки, непосредственным редактированием файла `fuckaba.bf`. Специально для этого в нём есть подстрока `Пароль`, после которой следуют 8 строк с минусами. Количество минусов соотвествует коду символа.

В директории `resources` есть два файла:
- `index.bin` - главная страница с ХТТП-заголовками;
- `redirect.bin` - ХТТП-ответ с перенаправлением на главную страницу.

Оба можно изменять, после чего требуется пересобрать движок. ХТТП-заголовки разделяются двухбайтовым переводом строки `\r\n` и должны быть отделены от страницы двумя такими переводами.
