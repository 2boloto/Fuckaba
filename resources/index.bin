HTTP/1.1 200 OK
Server: Fuckaba/1.0.0
Content-Type: text/html

<!doctype HTML>

<meta charset = "UTF-8" />

<title>Факаба</title>

<style>
	section {
		margin: 1em 0;
		max-width: 700px;

		overflow: auto;
	}

	.form {
		max-width: none;
		overflow: visible;
	}

	section h1 {
		margin-top: 0;
	}

	section textarea {
		width: 500px;
		height: 200px;
	}

	section object, section img {
		margin-right: 1em;
		max-width: 150px;
		max-height: 150px;

		float: left;
	}

	section pre {
		white-space: pre-wrap;
		overflow: auto;
	}

	section .quote {
		color: green;
	}
</style>

<script>
	var main = function () {
		var decodeImage = function (imageNode) {
			var encodedData = imageNode.data.substr(31);

			var type = "image/jpeg";
			var data = new Uint8Array(encodedData.length / 3);

			for (var i = 0; i < data.length; ++i) {
				data[i] = Number.parseInt(encodedData.substr(i * 3 + 1, 2), 16);
			}

			return new Blob([data], {"type": imageNode.type});
		};

		for (var postNode of document.querySelectorAll("section:not(.form)")) {
			var preNode = postNode.querySelector("pre");

			var ID = Number.parseInt(postNode.id.substr(1));

			preNode.innerHTML = preNode.innerHTML.replace(/&gt;&gt;[1-9][0-9]*/g, function (match) {
				var reference = Number.parseInt(match.substr(8));

				if (reference < ID) {
					return "<a href = \"#p" + reference.toString() + "\">" + match + "</a>";
				} else {
					return match;
				}
			}).replace(/^&gt;.*$/gm, function (match) {
					return "<span class = \"quote\">" + match + "</span>";
			});


			var imageNode = postNode.querySelector("object");
			var linkNode = document.createElement("a");
			var newImageNode = document.createElement("img");

			var image = decodeImage(imageNode);
			var link = URL.createObjectURL(image);

			newImageNode.src = link;
			linkNode.href = link;

			newImageNode.addEventListener("error", function (event) {
				this.parentNode.parentNode.removeChild(this.parentNode);
			});

			imageNode.parentNode.insertBefore(linkNode, imageNode);
			imageNode.parentNode.removeChild(imageNode);
			linkNode.appendChild(newImageNode);

			newImageNode.data = link;
			newImageNode.type = image.type;
		}
	};

	document.addEventListener("DOMContentLoaded", main);
</script>

<h1>Факаба</h1>

<section class = "form">
	<h1>Ответ</h1>

	<p>Доска сможет принять не более 999 постов. Размер картинки не должен превышать 64 КиБ, размер сообщения - 4 КиБ.</p>

	<form method = "post" enctype = "multipart/form-data">
		<p><label>Картинка: <input name = "picture" type = "file" accept = "image/jpeg,image/png,image/gif" /></label></p>

		<p><label for = "message">Сообщение:</label></p>

		<p><textarea id = "message" name = "message"></textarea></p>

		<p><input type = "submit" value = "Отправить" /></p>
	</form>
</section>

<section class = "form">
	<h1>Админка</h1>

	<form method = "post" enctype = "multipart/form-data" action = "/a">
		<p><label>Пароль: <input name = "password" /></label></p>

		<p><label>Номер поста: <input name = "number" /></label></p>

		<p><input type = "submit" value = "Удалить" /></p>
	</form>
</section>
